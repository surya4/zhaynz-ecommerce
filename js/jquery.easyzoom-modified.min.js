/*
 Creative Commons Attribution-ShareAlike 3.0
 @version 1.0.6
*/
(function(b){function h(d,h){var a=this;this.notifications={loading:"Loading high resolution image...",error:"There has been a problem with loading the image!"};this.settings=b.extend({selector:{preview:"#preview-zoom",window:"#window-zoom"}},h);var e=b("img:first",d),k=null,l=null,m=new Image,g=!1,n=null;this.init=function(c){n="undefined"!=typeof c?c:b(d).attr("data-image");a.reset().attachEventListener()};this.attachEventListener=function(){b(d).on({mouseover:function(){a.start()},mousemove:function(c){a.recognizeMouseMovement(c)}});
return a};this.detachEventListener=function(){b(d).off();return a};this.start=function(){a.modifyCursorAppearance("auto");g?a.showZoomWindow():(a.modifyCursorAppearance("progress"),a.showNotification(a.notifications.loading),a.waitUntilResourceIsLoaded(n))};this.reset=function(){g=!1;return a.fadeOut().detachEventListener()};this.fadeOut=function(){b(a.settings.selector.window).fadeOut();b(a.settings.selector.preview).fadeOut();return a};this.deferredFadeOut=function(c){setTimeout(function(){a.fadeOut()},
c)};this.waitUntilResourceIsLoaded=function(c){m.src=c;b(m).load(function(){g=!0;a.calculateRelationOfImageGeometry(this);a.start()}).error(function(){a.showErrorNotification()});return a};this.showZoomWindow=function(){b(a.settings.selector.window).html(m).fadeIn()};this.showPreview=function(c){b(a.settings.selector.preview).css(c).fadeIn()};this.calculateRelationOfImageGeometry=function(a){l=a.width/e.width();k=a.height/e.height()};this.recognizeMouseMovement=function(c){if(g)if(a.previewRemainsInScope(c)){var f=
(c.pageX-e.offset().left)*l-b(a.settings.selector.window).width()/2,d=(c.pageY-e.offset().top)*k-b(a.settings.selector.window).height()/2;b(a.settings.selector.window).children("img:first").css({left:-f,top:-d});a.showPreview(a.getPositionPropertiesPreview(c));a.showZoomWindow()}else a.fadeOut()};this.getPositionPropertiesPreview=function(c){var f={height:b(a.settings.selector.window).height()/k,width:b(a.settings.selector.window).width()/l},d=b(e).offsetParent().offset();return b.extend(f,{left:c.pageX-
f.width/2-d.left,top:c.pageY-f.height/2-d.top})};this.previewRemainsInScope=function(a){var d=b(e);return a.pageX<d.offset().left||a.pageX>d.offset().left+d.width()||a.pageY<d.offset().top||a.pageY>d.offset().top+d.height()?!1:!0};this.showNotification=function(c){b(a.settings.selector.window).fadeIn().text(c);return a};this.showErrorNotification=function(){a.modifyCursorAppearance("auto").showNotification(a.notifications.error).deferredFadeOut(2E3)};this.modifyCursorAppearance=function(c){b(d).css("cursor",
c);return a};a.init()}b.fn.easyZoom=function(d){return this.each(function(){b.data(this,"easyZoom",new h(this,d))})}})(jQuery);
